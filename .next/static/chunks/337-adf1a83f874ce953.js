"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[337],{9376:function(e,t,a){var r=a(5475);a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},1955:function(e,t,a){a.d(t,{P:function(){return h}});var r=a(7437),o=a(2265),n=a(3301),s=a(6410),c=a(3310),i=a(7536);let l=()=>{let[e,t]=(0,o.useState)(null),{login:a}=(0,c.a)(),{addToast:r}=(0,i.p)(),l=e=>{switch(e){case"google":return s.Vv;case"microsoft":return s.O6;case"linkedin":return s.L2;default:throw Error("Unsupported provider: ".concat(e))}},u=async(e,t,o)=>{try{var n,s;let c=e.displayName||(null===(n=e.email)||void 0===n?void 0:n.split("@")[0])||"User",i=o.organizationName||"".concat(c,"'s Organization"),l=await fetch("/api/auth/social-signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,name:c,organizationName:i,provider:t,providerUid:e.uid,photoURL:e.photoURL})}),u=await l.json();if(u.success){let t=await e.getIdToken();return await a(t),r({message:"Welcome to Cash Flow Finder! Account created successfully.",type:"success"}),{success:!0,isNewUser:!0}}throw Error((null===(s=u.error)||void 0===s?void 0:s.message)||"Failed to create account")}catch(e){return console.error("Social account creation error:",e),r({message:e.message||"Failed to create account. Please try again.",type:"error"}),{success:!1,error:e.message}}};return{signInWithSocial:async function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t(e);try{let t=l(e),c=(await (0,n.rh)(s.I8,t)).user,i=await c.getIdToken();try{return await a(i),r({message:"Successfully signed in!",type:"success"}),{success:!0,isNewUser:!1}}catch(t){if(t.message.includes("not found")||t.message.includes("INVALID_CREDENTIALS"))return await u(c,e,o);throw t}}catch(a){console.error("".concat(e," auth error:"),a);let t="Failed to sign in with ".concat(e,". Please try again.");return"auth/popup-closed-by-user"===a.code?t="Sign in was cancelled.":"auth/popup-blocked"===a.code?t="Pop-up was blocked. Please allow pop-ups and try again.":"auth/account-exists-with-different-credential"===a.code&&(t="An account already exists with this email using a different sign-in method."),r({message:t,type:"error"}),{success:!1,error:t}}finally{t(null)}},linkSocialAccount:async e=>{t(e);try{let t=l(e);return await (0,n.rh)(s.I8,t),r({message:"Successfully linked ".concat(e," account!"),type:"success"}),{success:!0}}catch(a){console.error("Link ".concat(e," error:"),a);let t="Failed to link ".concat(e," account.");return"auth/credential-already-in-use"===a.code&&(t="This ".concat(e," account is already linked to another user.")),r({message:t,type:"error"}),{success:!1,error:t}}finally{t(null)}},loading:e,isLoading:t=>e===t}};var u=a(2496);let d=[{id:"google",name:"Google",icon:(0,r.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),(0,r.jsx)("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),(0,r.jsx)("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),(0,r.jsx)("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),bgColor:"bg-white hover:bg-gray-50",textColor:"text-gray-900",borderColor:"border-gray-300"},{id:"linkedin",name:"LinkedIn",icon:(0,r.jsx)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{fill:"#0077B5",d:"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"})}),bgColor:"bg-[#0077B5] hover:bg-[#005885]",textColor:"text-white",borderColor:"border-[#0077B5]"}],h=e=>{let{mode:t,onSuccess:a,className:o=""}=e,{signInWithSocial:n,isLoading:s}=l(),c=async e=>{let t=await n(e,{organizationName:void 0});t.success&&a&&a(e,t.isNewUser||!1)};return(0,r.jsx)("div",{className:"space-y-3 ".concat(o),children:d.map(e=>(0,r.jsx)("button",{type:"button",disabled:s(e.id),onClick:()=>c(e.id),className:"\n            w-full flex items-center justify-center px-4 py-2 border rounded-lg font-medium transition-colors duration-200\n            ".concat(e.bgColor," ").concat(e.textColor," ").concat(e.borderColor,"\n            disabled:opacity-50 disabled:cursor-not-allowed\n            focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-trueblue\n          "),children:s(e.id)?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.T,{size:"sm",className:"mr-2"}),"login"===t?"Signing in...":"Creating account..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"mr-2",children:e.icon}),"login"===t?"Sign in with ".concat(e.name):"Sign up with ".concat(e.name)]})},e.id))})}},3310:function(e,t,a){a.d(t,{AuthProvider:function(){return u},a:function(){return d}});var r=a(7437),o=a(2265),n=a(6410),s=a(3301);let c=(0,o.createContext)(void 0),i=(e,t)=>{switch(t.type){case"SET_LOADING":return{...e,loading:t.payload};case"SET_USER":return{...e,user:t.payload};case"SET_AUTH_CONTEXT":return{...e,authContext:t.payload};case"SET_ERROR":return{...e,error:t.payload};case"CLEAR_AUTH":return{...e,user:null,authContext:null,error:null};default:return e}},l={user:null,authContext:null,loading:!0,error:null},u=e=>{let{children:t}=e,[a,u]=(0,o.useReducer)(i,l);(0,o.useEffect)(()=>(0,s.Aj)(n.I8,async e=>{if(u({type:"SET_USER",payload:e}),e)try{let t=await e.getIdToken();await d(t)}catch(e){console.error("Authentication error:",e),u({type:"SET_ERROR",payload:"Authentication failed"})}else u({type:"CLEAR_AUTH"}),localStorage.removeItem("authToken");u({type:"SET_LOADING",payload:!1})}),[]);let d=async e=>{try{let a=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({idToken:e})}),r=await a.json();if(r.success&&r.data){let{token:e,user:t}=r.data;localStorage.setItem("authToken",e),u({type:"SET_AUTH_CONTEXT",payload:t}),u({type:"SET_ERROR",payload:null})}else{var t;throw Error((null===(t=r.error)||void 0===t?void 0:t.message)||"Authentication failed")}}catch(e){console.error("Backend authentication error:",e),u({type:"SET_ERROR",payload:e.message})}},h=async e=>{u({type:"SET_LOADING",payload:!0});try{await d(e)}catch(e){u({type:"SET_ERROR",payload:e.message})}finally{u({type:"SET_LOADING",payload:!1})}},p=async()=>{try{await n.I8.signOut(),localStorage.removeItem("authToken"),u({type:"CLEAR_AUTH"})}catch(e){console.error("Logout error:",e),u({type:"SET_ERROR",payload:e.message})}},g=async()=>{if(a.user)try{let e=await a.user.getIdToken(!0);await d(e)}catch(e){console.error("Refresh auth error:",e),u({type:"SET_ERROR",payload:e.message})}},m={...a,login:h,logout:p,refreshAuth:g};return(0,r.jsx)(c.Provider,{value:m,children:t})},d=()=>{let e=(0,o.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},7536:function(e,t,a){a.d(t,{ToastProvider:function(){return s},p:function(){return i}});var r=a(7437),o=a(2265);let n=(0,o.createContext)(void 0),s=e=>{let{children:t}=e,[a,s]=(0,o.useState)([]),i=(0,o.useCallback)(e=>{let t=Math.random().toString(36).substr(2,9),a={...e,id:t};s(e=>[...e,a]),setTimeout(()=>{l(t)},e.duration||5e3)},[]),l=(0,o.useCallback)(e=>{s(t=>t.filter(t=>t.id!==e))},[]);return(0,r.jsxs)(n.Provider,{value:{toasts:a,addToast:i,removeToast:l},children:[t,(0,r.jsx)(c,{})]})},c=()=>{let{toasts:e,removeToast:t}=i();return(0,r.jsx)("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:e.map(e=>(0,r.jsxs)("div",{className:"\n            max-w-sm p-4 rounded-lg shadow-lg flex items-start space-x-3 animate-slide-up\n            ".concat("success"===e.type?"bg-success text-white":"","\n            ").concat("error"===e.type?"bg-error text-white":"","\n            ").concat("warning"===e.type?"bg-warning text-white":"","\n            ").concat("info"===e.type?"bg-trueblue text-white":"","\n          "),children:[(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsx)("p",{className:"text-sm font-medium",children:e.message})}),(0,r.jsx)("button",{onClick:()=>t(e.id),className:"ml-2 text-white/80 hover:text-white",children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},e.id))})},i=()=>{let e=(0,o.useContext)(n);if(void 0===e)throw Error("useToast must be used within a ToastProvider");return e}},2496:function(e,t,a){a.d(t,{T:function(){return o}});var r=a(7437);a(2265);let o=e=>{let{size:t="md",className:a=""}=e;return(0,r.jsx)("div",{className:"loading-spinner ".concat({sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8"}[t]," ").concat(a)})}},6410:function(e,t,a){a.d(t,{I8:function(){return i},L2:function(){return u},O6:function(){return d},Vv:function(){return l}});var r=a(996),o=a(3301),n=a(257);let s={apiKey:n.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:n.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:n.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:n.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:n.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:n.env.NEXT_PUBLIC_FIREBASE_APP_ID},c=(0,r.ZF)(s),i=(0,o.v0)(c),l=new o.hJ;l.addScope("email"),l.addScope("profile"),l.setCustomParameters({prompt:"select_account"});let u=new o.O4("oidc.linkedin");u.addScope("openid"),u.addScope("profile"),u.addScope("email");let d=new o.O4("microsoft.com");d.addScope("openid"),d.addScope("profile"),d.addScope("email")}}]);